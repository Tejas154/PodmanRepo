FROM registry.suse.com/bci/bci-base:15.5
LABEL maintainer="Hayath"
LABEL version="1.0"
LABEL description="The Rust In Its Full Glory"

# Update and install dependencies
RUN zypper update -y || (echo "Retrying..."; sleep 5; zypper update -y)
RUN zypper install -y openssl-devel
RUN zypper install -y --type pattern devel_basis

# Install rustup and Rust
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y

# Explicitly set up environment for subsequent commands
ENV PATH="/root/.cargo/bin:${PATH}"
ENV CARGO_HOME="/root/.cargo"
ENV RUSTUP_HOME="/root/.rustup"

# Install Rust components
RUN rustup target add wasm32-unknown-unknown && \
    cargo install trunk && \
    cargo install wasm-bindgen-cli && \
    cargo install cargo-make

# Set working directory
WORKDIR /project